import{createRef as e,createContext as t,useRef as n,createElement as i,useContext as r,useCallback as o,useEffect as s,useState as a}from"react";import{EventEmitter as d,DisposableCollection as l}from"@stoplight/lifecycle";import{observable as c,computed as h,action as u,configure as p}from"mobx";import{Classes as g,Menu as f,ContextMenu as m,Popover as v,Position as y,Callout as N,Intent as x,FAIcon as C}from"@stoplight/ui-kit";import w from"classnames";import{observer as b}from"mobx-react-lite";import{ErrorBoundary as E}from"@stoplight/react-error-boundary";import{FixedSizeList as D,VariableSizeList as O}from"@stoplight/ui-kit/ScrollList";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function I(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function T(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const L=()=>Math.random().toString(36).slice(2);class R{constructor(){this[Symbol.toStringTag]="SwappableWeakMap",this._collection=new WeakMap}delete(e){return this._collection.delete(e)}get(e){return this._collection.get(e)}set(e,t){return this._collection.set(e,t),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakMap}}class k{constructor(){this[Symbol.toStringTag]="SwappableWeakSet",this._collection=new WeakSet}delete(e){return this._collection.delete(e)}add(e){return this._collection.add(e),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakSet}}function S(e){return e===WeakMap?new R:new k}class _{constructor(e){this.size=e,this.head=-1,this.tail=-1,this.cache=new Map}set(e,t){(-1===this.head||e<this.head)&&(this.head=e),(-1===this.tail||e>this.tail)&&(this.tail=e),this.cache.size===this.size&&(e<=this.head?(this.cache.delete(this.tail),this.tail--):(this.cache.delete(this.head),this.head++)),this.cache.set(e,t)}get(e){return e<0?void 0:this.cache.get(e)}clear(e){if(e<=this.head)this.cache.clear();else{for(;e++<=this.tail;)this.cache.delete(e);this.tail=e}}}function j(e){if(void 0===e)throw new TypeError("Node expected")}function F(e){if(!P(e))throw new TypeError("Parent node expected")}const P=e=>"object"==typeof e&&null!==e&&"children"in e,M=e=>"object"==typeof e&&null!==e&&"level"in e,A=Symbol("COUNT"),Z=Symbol("LEVEL"),z=Symbol("DROP_ZONE_ID"),W=[];class ${constructor(e=null,t=$.createArtificialRoot(),n=200){this.iterationOptions=e,this.unwrapped=S(WeakSet),this.sorted=S(WeakSet),this.filtered=S(WeakMap),this._versionCounter=0,this._count=0,this.indexLookup=new _(n),this.setRoot(t)}get root(){return this._root}get versionCounter(){return this._versionCounter}set versionCounter(e){this._versionCounter=e}get count(){return this._count}set count(e){this._count=e,this.versionCounter++}setRoot(e){this._root=e,this.invalidate()}static getLevel(e){return e[Z]}static getDropZoneId(e){return e[z]}clearCache(){this.indexLookup.clear(-1)}getFilteredChildren(e){var t;if(!this.unwrapped.has(e))return W;const n=null===(t=this.iterationOptions)||void 0===t?void 0:t.filter;if(0===e.children.length)return e.children;const i=this.filtered.get(e);if(void 0!==i)return i;if(!n)return e.children;const r=e.children.filter(n);return this.filtered.set(e,r),r}getChildren(e){const t=this.getFilteredChildren(e);return null===this.iterationOptions||0===t.length?t:(null===this.iterationOptions.order||this.sorted.has(e)||(t.sort(this.iterationOptions.order),this.sorted.add(e)),t)}static _toTree(e,t){const n=[e];for(const e of t){const t=n[e.level],i=$.transformDeprecatedNode(e,null);P(i)&&(e.level>=n.length?n.push(i):n[e.level+1]=i),t&&(i.parent=t,t.children.push(i))}}static createArtificialRoot(){return{id:L(),name:"",parent:null,children:[]}}static toTree(e){const t={id:L(),name:"",parent:null,children:[]};return $._toTree(t,e.slice()),t}*[Symbol.iterator](){yield*this.getIteratorForNode(this.root)}*getIteratorForNode(e){for(const t of this.getChildren(e))yield t,P(t)&&(yield*this.getIteratorForNode(t))}static getOffsetForNode(e){return-1}_itemAt(e,t,n){if(t<0)return;const i=this.indexLookup.get(t);if(void 0!==i)return i;const{length:r}=n;for(const i of this.getChildren(e)){if(n.offset++,t===n.offset-1)return this.indexLookup.set(t,i),i;if(P(i)&&n.offset-1<=t&&t<=n.offset-1+r){n.length=i[A];const e=this._itemAt(i,t,n);if(void 0!==e)return e}else A in i&&(n.offset+=i[A])}}getLastItem(e){if(!P(e))return e;const t=this.getChildren(e);return 0===t.length?e:this.getLastItem(t[t.length-1])}_nextItem(e){if(null===e.parent)return;const t=this.getChildren(e.parent),n=0===t.length?-1:t.indexOf(e);return n<t.length-1?t[n+1]:this._nextItem(e.parent)}nextItem(e){if(P(e)){const t=this.getChildren(e);if(t.length>0)return t[0]}return this._nextItem(e)}prevItem(e){if(!P(e)||null===e.parent)return;const t=this.getChildren(e),n=0===t.length?-1:t.indexOf(e);return n>0&&t.length>0?this.getLastItem(t[n-1]):void 0}itemAt(e){if(!(e<0)){if(e<this.count&&this.indexLookup.tail+1===e){const t=this.indexLookup.get(this.indexLookup.tail);if(t){const n=this.nextItem(t);if(n)return this.indexLookup.set(e,n),n}}else if(e>1&&this.indexLookup.head-1===e){const t=this.indexLookup.get(this.indexLookup.head);if(t){const n=this.prevItem(t);if(n)return this.indexLookup.set(e,n),n}}return $.boundaries.offset=0,$.boundaries.length=this.count,this._itemAt(this.root,e,$.boundaries)}}indexOf(e){let t=0;for(const n of this){if(e===n)return t;t++}return-1}every(e,t){let n=0;for(const i of this)if(!e.call(t,i,n++,[]))return!1;return!0}findById(e){for(const t of this)if(t.id===e)return t}invalidate(){this.unwrapped.swap(),this.clearCache(),this.invalidateOrder(),this.invalidateNode(this.root),this.count=this.processTreeFragment(this.root)}forceUpdate(){this.versionCounter++}invalidateCounter(e,t){let n=e;do{this.resetCounter(n),n=n.parent}while(t&&null!==n)}invalidateLevel(e){if($.resetLevel(e),P(e))for(const t of e.children)this.invalidateLevel(t)}invalidateNode(e){this.invalidateLevel(e),P(e)&&(this.filtered.delete(e),this.sorted.delete(e),this.invalidateCounter(e,!0))}invalidateOrder(){this.sorted.swap(),this.filtered.swap()}wrap(e){this.unwrapped.has(e)&&(this.clearCache(),this.getFilteredChildren(e).length>0&&(this.count-=e[A]),this.unwrapped.delete(e),this.invalidateCounter(e,null!==e.parent&&this.unwrapped.has(e.parent)))}unwrap(e){var t;if(!this.unwrapped.has(e)){if(this.unwrapped.add(e),null!==e.parent&&!this.unwrapped.has(e.parent))return void this.invalidateCounter(e,!1);this.clearCache();const n=this.count,i=this.getFilteredChildren(e);if(i.length>0){const e=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;for(const t of i)!P(t)||this.unwrapped.has(t)||e&&!e(t)||this.unwrap(t)}this.invalidateCounter(e,!0),this.count=n+e[A]}}moveNode(e,t){this.removeNode(e),this.insertNode(e,t)}prepareNode(e,t){e.parent=t,t.children.push(e),P(e)&&!$.isDecoratedNode(e)?this.processTreeFragment(e):(this.decorateNode(e),this.invalidateLevel(e))}insertNode(e,t){const n=t[A];this.prepareNode(e,t),this.clearCache(),this.invalidateNode(t),this.count+=t[A]-n}insertTreeFragment(e,t){const n=t[A];for(const n of e)this.prepareNode(n,t);this.clearCache(),this.invalidateNode(t),this.count+=t[A]-n}removeNode(e){if(null===e.parent)throw new Error("Cannot remove root node");const{parent:t}=e,n=t[A];t.children.splice(t.children.indexOf(e),1),this.clearCache(),this.invalidateNode(t),this.count+=t[A]-n}replaceNode(e,t){if(null===e.parent)return F(t),void this.setRoot(t);const{parent:n}=e,i=n[A];n.children[n.children.indexOf(e)]=t,this.clearCache(),this.invalidateNode(n),this.count+=n[A]-i}getCount(e){return e[A]}setCount(e,t){e[A]=Math.max(0,t)}resetCounter(e){let t=0;for(const n of this.getFilteredChildren(e))A in n&&(t+=n[A]),t+=1;e[A]=t}processTreeFragment(e){var t;let n=0;if(this.decorateNode(e),P(e)){const i=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;if(!i||i(e)){this.unwrapped.add(e);for(const t of this.getFilteredChildren(e))P(t)?n+=this.processTreeFragment(t):this.decorateNode(t),n+=1}e[A]=n}return n}static resetLevel(e){Object.defineProperty(e,Z,$.level)}static resetDropZoneId(e){Object.defineProperty(e,z,$.dropZoneId)}decorateNode(e){Z in e||$.resetLevel(e),z in e||$.resetDropZoneId(e)}static isDecoratedNode(e){return"object"==typeof e&&null!==e&&Z in e&&z in e}static transformDeprecatedNode(e,t){const n={...e,...e.canHaveChildren&&{children:[]},parent:t};return delete n.level,delete n.canHaveChildren,n}}$.level={configurable:!0,get(){const{parent:e}=this,t=null===e?-1:(Z in e?e[Z]:0)+1;return P(this)&&Object.defineProperty(this,Z,{configurable:!0,value:t}),t}},$.dropZoneId={configurable:!0,get(){const{parent:e}=this,t=`${null!==e&&z in e?`${e[z]}${this.id}`:this.id}-`;return P(this)&&Object.defineProperty(this,z,{configurable:!0,value:t}),t}},$.boundaries={offset:0,length:0},I([c,T("design:type",Object)],$.prototype,"_versionCounter",void 0),I([h,T("design:type",Object),T("design:paramtypes",[Object])],$.prototype,"versionCounter",null),I([u,T("design:type",Function),T("design:paramtypes",[]),T("design:returntype",void 0)],$.prototype,"forceUpdate",null),I([u,T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],$.prototype,"invalidateNode",null);class B{constructor(e){var t,n,i;this.expanded=null!==(t=null==e?void 0:e.expanded)&&void 0!==t?t:{},this.activeNodeId=null!==(n=null==e?void 0:e.activeNodeId)&&void 0!==n?n:null,this.editedNodeId=null!==(i=null==e?void 0:e.editedNodeId)&&void 0!==i?i:null}setExpanded(e){this.expanded=e}}I([c.shallow,T("design:type",Object)],B.prototype,"expanded",void 0),I([c,T("design:type",Object)],B.prototype,"activeNodeId",void 0),I([c,T("design:type",Object)],B.prototype,"editedNodeId",void 0),I([u,T("design:type",Function),T("design:paramtypes",[Object]),T("design:returntype",void 0)],B.prototype,"setExpanded",null);class G extends ${constructor(e,t,n=null){const i=t(e);super(n,i),this.transformNode=t,this.transformedNodes=new WeakMap([[e,i]]),this.transformChildren(i),this.processTreeFragment(this.root),this.count=this.getCount(this.root)}transform(e,t){const n=this.transformNode(e);return n.parent=t,n}transformChildren(e){e.children=e.children.map(t=>{const n=this.transformNode(t);return n.parent=e,super.decorateNode(n),n})}decorateNode(e){if(G.isDecoratedNode(e))return;const t=this.transform(e,e.parent&&this.transformedNodes.get(e.parent)||null);"children"in e&&(this.transformedNodes.set(e,t),this.transformChildren(t)),super.decorateNode(t)}}class H extends ${constructor(e,t=null,n=$.createArtificialRoot(),i=200){super(t,n,i),this.visited=S(WeakSet),this.computeRows=e}static mapById(e){return e.id}compute(e,t){if(!this.visited.has(e)){e.children=this.computeRows(e),void 0!==t&&(e.children=e.children.filter(e=>!t.includes(e.id)));for(const t of e.children)this.decorateNode(t);this.visited.add(e)}}processTreeFragment(e){return this.compute(e),super.processTreeFragment(e)}unwrap(e){return this.compute(e),super.unwrap(e)}insertTreeFragment(e,t){return this.compute(t,e.map(H.mapById)),super.insertTreeFragment(e,t)}insertNode(e,t){return this.compute(t,[e.id]),super.insertNode(e,t)}invalidate(){if(this.computeRows)return this.visited.swap(),super.invalidate()}}var V,U;!function(e){e.NodeClick="node.click",e.NodeMouseEnter="node.mouseenter",e.NodeMouseLeave="node.mouseexit",e.NodeDoubleClick="node.doubleClick",e.NodeCaretClick="node.caretClick",e.NodeExpand="node.expand",e.Drop="drop",e.EditCancel="edit.cancel",e.ValidationError="edit.validationError",e.BeforeEditComplete="edit.beforecomplete",e.AfterEditComplete="edit.aftercomplete"}(V||(V={})),function(e){e.Right="right",e.Down="down"}(U||(U={})),p({enforceActions:"observed"});class K{constructor(t,n,i){this.state=n,this.icons={},this.defaultExpandedDepth=0,this._innerPadding=null,this.instanceRef=e(),this.events=new d,this.setActiveNode=e=>{this.state.activeNodeId=e},this.setEditedNode=e=>{this.state.editedNodeId=e},this.scrollToItem=e=>{if(!this.instanceRef.current)return;P(e)&&this.toggleExpand(e,!0);let t=this.tree.indexOf(e);if(-1===t)return;const n=this.instanceRef.current.props,{itemCount:i}=n;if(!K.isFixedSizeList(n))return void this.instanceRef.current.scrollToItem(t,"start");const{scrollOffset:r}=this.instanceRef.current.state;t=Math.max(0,Math.min(t+(this.innerPadding?1:0),i-1));const o=K.getOffsetForIndexAndAlignment(n,t,r,this.innerPadding);o===r||this.instanceRef.current.scrollTo(o)},this.rename=async(e,t)=>{this.setEditedNode(e.id);const n=new l;try{return await new Promise((e,i)=>{n.pushAll([this.events.on(V.BeforeEditComplete,async(e,n)=>{try{void 0!==t&&await t(e,n),this.events.emit(V.AfterEditComplete,e,n)}catch(e){this.events.emit(V.ValidationError,e)}}),this.events.on(V.AfterEditComplete,e),this.events.on(V.EditCancel,i)])})}finally{n.dispose(),this.setEditedNode(null)}},this.tree=t,Object.assign(this,i),this.placeholderId=L()}get innerPadding(){return this._innerPadding}set innerPadding(e){this._innerPadding=e}dispose(){this.events.dispose()}static isFixedSizeList(e){return"number"==typeof e.itemSize}static getOffsetForIndexAndAlignment({direction:e,height:t,itemCount:n,itemSize:i,layout:r,width:o},s,a,d){const l=Number("horizontal"===e||"horizontal"===r?o:t)-(null!=d?d:0),c=Math.max(0,n*i-l),h=Math.min(c,s*i);return a>=Math.max(0,s*i-l+i)&&a<=h?a:h}toggleExpand(e,t){F(e);const{expanded:n}=this.state;if(void 0===t||t!==n[e.id]){const n=this.state.expanded[e.id]=null!=t?t:!this.isNodeExpanded(e);this.events.emit(V.NodeExpand,e,n),n?this.tree.unwrap(e):this.tree.wrap(e)}if(!this.isNodeExpanded(e))return;const i=e.parent;null===i||this.isNodeExpanded(i)||this.toggleExpand(i,!0)}expandAll(e){for(const t of this.tree)P(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!0)}collapseAll(e){for(const t of this.tree)P(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!1)}static isNodeExpanded(e,t,n){return!(e.id in t)&&$.getLevel(e)<=n||!0===t[e.id]}isNodeExpanded(e){return K.isNodeExpanded(e,this.state.expanded,this.defaultExpandedDepth)}isAllExpanded(){return this.tree.every(e=>null===e.parent||!P(e)||this.isNodeExpanded(e))}isAllCollapsed(){return this.tree.every(e=>null===e.parent||!P(e)||!this.isNodeExpanded(e))}async create(e,t,n){const i=Object.assign(e,{name:"",parent:t});this.tree.invalidateNode(i),this.toggleExpand(t,!0),this.tree.insertNode(i,t);try{return await this.rename(i,n),null!==i.parent&&this.tree.invalidateNode(i.parent),i}catch(e){throw this.tree.removeNode(i),e}}}I([c.shallow,T("design:type",Object)],K.prototype,"tree",void 0),I([c,T("design:type",Object)],K.prototype,"icons",void 0),I([c,T("design:type",Object)],K.prototype,"_innerPadding",void 0),I([h,T("design:type",Object),T("design:paramtypes",[Object])],K.prototype,"innerPadding",null),I([u,T("design:type",Object)],K.prototype,"setActiveNode",void 0),I([u,T("design:type",Object)],K.prototype,"setEditedNode",void 0),I([u,T("design:type",Function),T("design:paramtypes",[Object,Boolean]),T("design:returntype",void 0)],K.prototype,"toggleExpand",null);class Y{constructor(){this.attach=e=>{null!==this.node&&(document.body.appendChild(this.node),e.dataTransfer.setDragImage(this.node,-10,-10),setTimeout(this.detach,0))},this.detach=()=>{null!==this.node&&this.node.remove()},"undefined"!=typeof document?(this.node=document.createElement("span"),this.node.className=w(g.TAG,g.ROUND),this.node.style.zIndex=String(8388598)):this.node=null}get content(){var e,t;return null!==(t=null===(e=this.node)||void 0===e?void 0:e.textContent)&&void 0!==t?t:null}set content(e){null!==this.node&&(this.node.textContent=e)}}function X(e){if("undefined"==typeof document)return;const t=document.createElement("style");return t.textContent=e,document.body.appendChild(t)}class q{constructor(e){this.rootZoneId=e,this.cache=new WeakMap}setGenericStyles(){this.genericStyle=X(q.generateStyles("[data-drop-zone-id]:hover",{"background-color":"inherit",color:"inherit"}))}clearGenericStyles(){void 0!==this.genericStyle&&(this.genericStyle.remove(),this.genericStyle=void 0)}setRange(e){const t=X(q.generateStyles(null===e.parent?`[data-root-drop-zone="${this.rootZoneId}"] [data-drop-zone-id]:not([data-active-tree-node])`:`[data-drop-zone-id^="${$.getDropZoneId(e)}"]:not([data-active-tree-node])`,{"background-color":"var(--highlighted-bg) !important",color:"var(--highlighted-fg) !important"}));void 0!==t&&this.cache.set(e,t)}clearRange(e){const t=this.cache.get(e);void 0!==t&&(t.remove(),this.cache.delete(e))}static generateStyles(e,t){return`\n      ${e} { ${n=t,Object.entries(n).map(e=>e.join(":")).join(";")} }\n    `;var n}}class J{constructor(){this.dropPermissions=new Map,this.id=J.seed++,this.highlighter=new q(this.id),this.ghost=new Y}clear(){void 0!==this.currentDragZone&&this.highlighter.clearRange(this.currentDragZone),this.highlighter.clearGenericStyles(),void 0!==this.collapseTimeout&&(this.collapseTimeout=clearTimeout(this.collapseTimeout)),this.initialNode=void 0,this.initialDragZone=void 0,this.currentDragZone=void 0,this.dropPermissions.clear()}}J.seed=0;const Q=t({store:new K(new $,new B),draggable:new J}),ee=t({}),te=({store:e,className:t,innerClassName:r,itemClassName:o,children:s})=>{const a={draggable:n(new J).current,store:e},d={itemClassName:o,innerClassName:r,className:t};return i(Q.Provider,{value:a},i(ee.Provider,{value:d},s))},ne=e=>r(ee)[e],ie=e=>e.map((e,t)=>{const{divider:n,children:r,...o}=e;return n?i(f.Divider,Object.assign({key:t},o)):i(f.Item,Object.assign({key:t},o),r&&r.length?ie(r):null)}),re=e=>i(f,null,ie(e.items));function oe(){return r(Q).draggable}function se(){return r(Q).store}const ae=(e,t)=>{const{state:{activeNodeId:n}}=se(),r=oe();return o(o=>{if(!t)return;const s=t(e);void 0!==s&&(o.preventDefault(),o.stopPropagation(),s.length>0&&(n!==e.id&&P(e)&&null!==e.parent&&r.highlighter.setRange(e),m.show(i(re,{items:s}),{left:o.clientX,top:o.clientY},()=>{P(e)&&r.highlighter.clearRange(e)})))},[t,n,r,e])},de=(e,t)=>{const n=se();return o(i=>{null!==t&&n.events.emit(e,i,t)},[n,e,t])},le=({children:e,className:t,style:n,onContextMenu:r})=>{const a=se(),d=oe();s(()=>()=>{d.clear()},[d]);const l=o(e=>{void 0!==d.currentDragZone&&d.dropPermissions.get(d.currentDragZone.id)&&e.preventDefault()},[d]),c=o(()=>{d.clear()},[d]),h=o(e=>{e.preventDefault();const{initialNode:t,currentDragZone:n}=d;try{void 0!==t&&void 0!==n&&a.events.emit(V.Drop,t,n)}finally{d.clear()}},[d,a]);return i("div",{className:t,style:n,"data-root-drop-zone":d.id,onDrop:h,onDragOver:l,onDragEnd:c,onContextMenu:r},e)},ce=b(e=>{const{node:t,tree:n,autoExpandDelay:s,canDrop:a,canDrag:d,rowHeight:l,rowRenderer:c,className:h,...u}=e,{draggable:p}=r(Q),g=se(),f=P(t)?t:t.parent;if(null===f)throw new Error("Cannot drag root node");const m=o(e=>{const{dropPermissions:n,currentDragZone:i,initialDragZone:r,collapseTimeout:o,initialNode:d,highlighter:l}=p;if(void 0!==o&&(p.collapseTimeout=clearTimeout(o)),void 0===r||void 0===d)return;let c=n.get(e.id);void 0===c&&(c=void 0===a||a(d,e),n.set(e.id,!!c)),void 0!==i&&l.clearRange(i),e.id!==r.id&&c?(p.currentDragZone=e,l.setRange(e),P(t)&&(p.collapseTimeout=setTimeout(g.toggleExpand.bind(g,t,!0),s))):p.currentDragZone=void 0},[p,t,t.parent,a,g,s]),v=o(()=>{m(f)},[f,m]),y=o(e=>{if(void 0!==d&&!d(t))return void e.preventDefault();p.currentDragZone=f,p.initialDragZone=f,p.initialNode=t;const n=t.parent;n&&p.dropPermissions.set(n.id,!1),p.highlighter.setGenericStyles(),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",t.id),p.ghost.content=t.name,p.ghost.attach(e),P(t)&&g.toggleExpand(t,!1)},[d,t,t.parent,p.currentDragZone,p.initialDragZone,p.initialNode,p.highlighter,p.ghost,p.dropPermissions,f,g]),N=o(e=>{e.relatedTarget&&"closest"in e.relatedTarget&&!e.relatedTarget.closest("[data-drop-zone-id]")&&e.relatedTarget.closest("[data-root-drop-zone]")&&m(n.root)},[m,n.root]);return i("div",Object.assign({},u,{className:h,draggable:!0,onDragStart:y,onDragEnter:v,onDragLeave:N}))}),he=b(({className:e,node:t,placeholder:r})=>{const d=se(),[l,c]=a(null),h=n();s(()=>d.events.on(V.ValidationError,e=>{c(e.message)}).dispose,[d,c]),s(()=>{const{current:e}=h;if(e){const t=e.value.indexOf(".");e.setSelectionRange(0,-1===t?e.value.length:t,"forward")}},[]);const u=o(e=>{""!==e.target.value&&c(null)},[]),p=o(()=>{d.events.emit(V.EditCancel)},[d]),g=o(e=>{switch(e.key){case"Enter":t.name=h.current.value,d.events.emit(V.BeforeEditComplete,t,t.parent);break;case"Escape":p()}},[t,d,p]),f=o(e=>{const t=e.target.value,n=t.indexOf(".");e.target.setSelectionRange(0,-1===n?t.length:n,"forward")},[]);return i(v,{minimal:!0,isOpen:null!==l,usePortal:!0,position:y.BOTTOM_RIGHT,target:i("input",{autoFocus:!0,autoComplete:"off",ref:h,className:w(e,"TreeListItem__input"),onKeyDown:g,onInput:u,onBlur:p,onFocus:f,defaultValue:t.name,placeholder:r}),content:i(N,{intent:x.DANGER},l)})}),ue={[U.Down]:{default:"chevron-down"},[U.Right]:{default:"chevron-right"}},pe=({expanded:e,node:t,icons:n})=>{const r=se();let o=null;if(P(t)){const s=e?U.Down in n?n[U.Down]:ue[U.Down]:U.Right in n?n[U.Right]:ue[U.Right],a="function"==typeof s?s.call(r,t):s;null!=a&&null!==a.default&&(o=i(C,{size:"sm",icon:a.default,style:{color:a.color}}))}return i("span",{className:"TreeListItem__caret"},o)};const ge=b(({expanded:e,icons:t,node:n})=>{const r=se(),o=void 0!==n.type?t[n.type]:void 0,s="function"==typeof o?o.call(r,n):o;if(void 0===s)return null;const a=function(e,t){return null===e?e:t&&void 0!==e.expanded?e.expanded:e.default}(s,!!e);return i("span",{className:"TreeListItem__icon"},null!=a?i(C,{icon:a,style:{color:null==s?void 0:s.color}}):null)}),fe=800,me=30,ve=b(({className:e,isExpanded:t,isEdited:n,isExpandable:r,node:o,placeholder:s})=>{const a=se(),d=de(V.NodeCaretClick,o);return i("div",{className:w("flex-1 flex items-center",e),style:{paddingLeft:15*$.getLevel(o)}},r&&i(pe,{onClick:d,expanded:t,icons:a.icons,node:o}),i(ge,{expanded:t,icons:a.icons,node:o}),n?i(he,{node:o,placeholder:s}):i("span",{className:"TreeListItem__label",title:o.name},o.name))}),ye=b(e=>{const{data:t,index:n,style:r}=e,{innerPadding:o,tree:s,rowRenderer:a,generateContextMenu:d,striped:l,...c}=t,h=ne("itemClassName"),u=se(),p=o?n-1:n,g=-1===p?null:s.itemAt(p);if(void 0===g)throw new Error("Could not find node.");const f=de(V.NodeClick,g),m=de(V.NodeMouseEnter,g),v=de(V.NodeMouseLeave,g),y=ae(g,d);if(null===g)return i("div",{style:r});const N=u.state.editedNodeId===g.id,x=u.state.activeNodeId===g.id,C=P(g)&&u.isNodeExpanded(g),b=w(`TreeListItem TreeListItem--${$.getLevel(g)}`,g.className,h,{"TreeListItem--active":x,"TreeListItem--striped":l&&p%2!=0});let E;E="function"==typeof a?a(g,{isEdited:N,isExpanded:C}):i(ve,{node:g,isEdited:N,isExpanded:C});const D={...r,...o&&r&&r.top&&{top:Number(r.top)-o}};return u.state.editedNodeId===g.id?i("div",{key:g.id,className:b,style:D},E):i(ce,Object.assign({key:g.id,className:b,"data-drop-zone-id":$.getDropZoneId(g),node:g,onClick:f,onMouseEnter:m,onMouseLeave:v,onContextMenu:y,tree:s,style:D},x&&{"data-active-tree-node":!0},c),E)}),Ne=b(e=>{const{autoExpandDelay:t=fe,rowHeight:n=me,rowRenderer:r,canDrag:a,canDrop:d,generateContextMenu:l,style:c,striped:h,innerPadding:u,autoSize:p,maxRows:g,interactive:f=!0,initialScrollOffset:m,onScroll:v}=e,y=se(),N=ne("className"),x=ne("innerClassName"),C=ae(y.tree.root,l),b=y.instanceRef,E=y.tree;if("boolean"==typeof u&&"function"==typeof n)throw new Error("You need to provide an absolute value for padding in case of VariableSizeList");const I="boolean"==typeof u?Number(n)/2:u,T=E.count+(I?1:0);s(()=>{y.innerPadding=null!=I?I:null},[I,y]),s(()=>{null!==b.current&&"resetAfterIndex"in b.current&&b.current.resetAfterIndex(0,!0)},[b,E.versionCounter]);const L={canDrag:a,canDrop:d,autoExpandDelay:t,rowRenderer:r,rowHeight:n,innerPadding:I,tree:E,generateContextMenu:l,striped:h},R=o(e=>{if(I&&0===e)return y.placeholderId;const t=E.itemAt(I?e-1:e);return t?`${t.id}-${t.type}`:""},[E,y.placeholderId,I]),k=o(e=>{if(0===e&&I)return 2*I;const t=I?e-1:e,i=E.itemAt(t);return"function"==typeof n&&void 0!==i?n(i,t):0},[I,E,n]),S={className:x,itemData:L,itemKey:R,itemCount:T,maxRows:g,initialScrollOffset:m,onScroll:v};return 0===T?null:i(le,{style:c,onContextMenu:C,className:w("TreeList",N,{"TreeList--interactive":f})},"function"!=typeof n?i(D,Object.assign({},S,{autoSize:p,instanceRef:b,itemSize:n}),ye):i(O,Object.assign({},S,{instanceRef:b,itemSize:k}),ye))}),xe=({error:e})=>i("div",{className:"p-4"},i("b",null,"Error"),e&&`: ${e.message}`),Ce=({onError:e,FallbackComponent:t=xe,store:n,className:r,innerClassName:o,itemClassName:s,...a})=>i(E,{onError:e,FallbackComponent:t},i(te,{store:n,className:r,itemClassName:s,innerClassName:o},i(Ne,Object.assign({},a))));Ce.displayName="TreeList";export{H as ComputableTree,G as GenericTree,$ as Tree,Ce as TreeList,U as TreeListCaretIcons,he as TreeListEditableItem,V as TreeListEvents,ve as TreeListRow,B as TreeState,K as TreeStore,j as assertNode,F as assertParentNode,M as isDeprecatedTreeListNode,P as isParentNode,ne as useClassName,ae as useContextMenu,oe as useDraggable,de as useNodeCallback,se as useStore};
